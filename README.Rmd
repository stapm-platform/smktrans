---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# smktrans <img src="man/figures/logo.png" align="right" style="padding-left:10px;background-color:white;" width="120" />

### An R Package and Workflow for estimating smoking state transition probabilities

[![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![Lifecycle: maturing](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://www.tidyverse.org/lifecycle/#maturing)
[![](https://img.shields.io/badge/doi-10.17605/OSF.IO/YGXQ9-green.svg)](https://doi.org/10.17605/OSF.IO/YGXQ9)

---

## Overview

**smktrans** is an estimation workflow structured as an R package. It serves two purposes:  

1.  **Toolbox:** It provides a set of R functions to estimate transition probabilities among current, former, and never smoking states (initiation, quitting, and relapse) from repeat cross-sectional survey data.  

2.  **Workflow:** It contains the specific analytical workflow used to produce the official estimates for the Sheffield Tobacco Policy Model (STPM).  

This package is part of the [Sheffield Tobacco and Alcohol Policy Modelling (STAPM) platform](https://stapm-platform.github.io/).

---

## Why use this package?
smktrans solves the "missing data" problem in dynamic tobacco modelling:

Cohort Reconstruction: Converts snapshot survey data into longitudinal histories to estimate initiation rates.

The "Quit Solver": Calculates quit rates (which are notoriously hard to measure directly from survey prevalence alone) by solving the flow equation: Change in Prevalence = Initiation + Relapse - Quitting - Mortality.

Forecasting: Projects these rates into the future (e.g., to 2100) to support long-term policy impact assessments.

---

## Package Structure

While `smktrans` can be installed and used like a standard R package, it is designed to encompass both the tools *and* the analysis. 

The estimates produced by this workflow are probabilities of **smoking initiation**, **quitting**, and **relapse**, stratified by:
* Age
* Period
* Sex
* Index of Multiple Deprivation (IMD) quintiles

### Open Science & Estimates
We have made this code open source to ensure transparency, share methodology, and allow others to utilize our pre-calculated estimates for England, Scotland and Wales [Download via OSF](https://osf.io/zy9q8)

---

## ðŸ›  Installation

`smktrans` relies on several internal STAPM packages (e.g. `hseclean`, `tobalcepi`, `mort.tools`). You can install the package directly from GitHub. (to be honest, we've never had anyone other than the internal STAPM team use the package, so it has not been tested outside of our team environment)

``` r
# install.packages("devtools")

# 1. Install dependencies
devtools::install_git("[https://github.com/stapm/hseclean.git](https://github.com/stapm-platform/hseclean.git)", build_vignettes = FALSE, quiet = TRUE)
devtools::install_git("[https://github.com/stapm/tobalcepi.git](https://github.com/stapm-platform/tobalcepi.git)", build_vignettes = FALSE, quiet = TRUE)
devtools::install_git("[https://github.com/stapm/mort.tools.git](https://github.com/stapm-platform/mort.tools.git)", build_vignettes = FALSE, quiet = TRUE)

# 2. Install smktrans
devtools::install_git("[https://github.com/stapm-platform/smktrans.git](https://github.com/stapm-platform/smktrans.git)", build_vignettes = FALSE, quiet = TRUE)

```
