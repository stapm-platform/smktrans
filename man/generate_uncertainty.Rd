% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generate_uncertainty.R
\name{generate_uncertainty}
\alias{generate_uncertainty}
\title{Generate Uncertainty Intervals for Transition Probabilities}
\usage{
generate_uncertainty(data, prob_col, n_eff, n_samp, correlation)
}
\arguments{
\item{data}{Data table. Must contain the probability column.}

\item{prob_col}{Character. Name of the column containing the point estimate probabilities (e.g., "p_start").}

\item{n_eff}{Numeric. The effective sample size used to calculate variance. 
Higher \code{n} implies narrower confidence intervals.}

\item{n_samp}{Integer. Number of Monte Carlo samples to generate (e.g., 100 or 1000).}

\item{correlation}{Numeric (0-1). The correlation coefficient (\eqn{R}) between rows in a single sample iteration. 
High correlation implies that if one age group is overestimated, others likely are too.}
}
\value{
A list containing:
\itemize{
  \item \code{data}: The original data table with added summary columns 
        (\code{_low}, \code{_median}, \code{_high}, \code{_var}).
  \item \code{samples}: A matrix of dimensions \code{[nrow(data) x n_samp]} containing the simulated values.
}
}
\description{
Estimates uncertainty around transition probabilities using a Beta distribution 
assumption derived from the binomial variance of the sample size. It generates 
correlated Monte Carlo samples (using a Gaussian Copula) to preserve the 
relationship between age/cohort groups across iterations.

The process follows these steps:
1. \strong{Standard Error}: Calculates SE based on the effective sample size (\eqn{SE = \sqrt{p(1-p)/n}}).
2. \strong{Beta Parameters}: Converts the Mean (p) and Variance (SE^2) into Beta shape parameters (\eqn{\alpha, \beta}).
3. \strong{Correlated Sampling}: Generates a matrix of correlated uniform probabilities using a Gaussian Copula.
   \itemize{
     \item Common factor \eqn{Z_{shared}} accounts for systematic uncertainty.
     \item Idiosyncratic factor \eqn{Z_{indiv}} accounts for random noise.
   }
4. \strong{Inverse CDF}: Maps these probabilities through the \code{qbeta} function to get the final samples.
}
