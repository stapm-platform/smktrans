<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Forecast relapse probabilities — relapse_forecast • smktrans</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Forecast relapse probabilities — relapse_forecast"><meta name="description" content="Produces future projections of the annual probabilities of relapse by former smokers,
stratified by age, sex, IMD quintile and the number of years since quitting (up to 10 years)."><meta property="og:description" content="Produces future projections of the annual probabilities of relapse by former smokers,
stratified by age, sex, IMD quintile and the number of years since quitting (up to 10 years)."><meta property="og:image" content="https://stapm-platform.github.io/smktrans/logo.png"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-167990045-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-167990045-1');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">smktrans</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/smktrans.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-technical-documentation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Technical documentation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-technical-documentation"><li><a class="dropdown-item" href="../articles/smk_trans_prob_estimation.html">Estimation workflow</a></li>
    <li><a class="dropdown-item" href="../articles/smoking_transition_probabilities_modelling_report.pdf">Methods notes: Smoking state transition probability estimation</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/stapm-platform/smktrans" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Forecast relapse probabilities</h1>
      <small class="dont-index">Source: <a href="https://github.com/stapm-platform/smktrans/blob/HEAD/R/relapse_forecast.R" class="external-link"><code>R/relapse_forecast.R</code></a></small>
      <div class="d-none name"><code>relapse_forecast.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Produces future projections of the annual probabilities of relapse by former smokers,
stratified by age, sex, IMD quintile and the number of years since quitting (up to 10 years).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">relapse_forecast</span><span class="op">(</span></span>
<span>  <span class="va">relapse_forecast_data</span>,</span>
<span>  <span class="va">relapse_by_age_imd_timesincequit</span>,</span>
<span>  jump_off_year <span class="op">=</span> <span class="fl">2018</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-relapse-forecast-data">relapse_forecast_data<a class="anchor" aria-label="anchor" href="#arg-relapse-forecast-data"></a></dt>
<dd><p>Data table - the output from <code><a href="quit_forecast.html">quit_forecast()</a></code>.</p></dd>


<dt id="arg-relapse-by-age-imd-timesincequit">relapse_by_age_imd_timesincequit<a class="anchor" aria-label="anchor" href="#arg-relapse-by-age-imd-timesincequit"></a></dt>
<dd><p>Data table - the output from <code><a href="prep_relapse.html">prep_relapse()</a></code>
that has the relapse probabilities stratified by age, sex, IMD quintile and time since quitting.</p></dd>


<dt id="arg-jump-off-year">jump_off_year<a class="anchor" aria-label="anchor" href="#arg-jump-off-year"></a></dt>
<dd><p>integer - the last year of observed data.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a data.table of past and future relapse probabilities
stratified by age, sex, IMD quintile and time since quitting.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>It is difficult to reliably forecast values that are stratified by age, sex, IMD quintile and
time since quitting due to the high dimensionality of these data.
We therefore forecast the values stratified by age, sex and IMD quintile,
and from these forecasts calculate scaling values that
are then applied to the relapse probabilities estimated from the last year of observed data
to produce forecasts stratified by age, sex, IMD quintile and
time since quitting.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Combine published estimates of long-term relapse with </span></span></span>
<span class="r-in"><span><span class="co"># the Health Survey for England data to arrive at the expected values </span></span></span>
<span class="r-in"><span><span class="co"># for relapse probabilities within defined subgroups.</span></span></span>
<span class="r-in"><span><span class="va">relapse_data</span> <span class="op">&lt;-</span> <span class="fu">smktrans</span><span class="fu">::</span><span class="fu"><a href="prep_relapse.html">prep_relapse</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">hse_data</span>,</span></span>
<span class="r-in"><span>  hawkins_relapse <span class="op">=</span> <span class="fu">smktrans</span><span class="fu">::</span><span class="va"><a href="hawkins_relapse.html">hawkins_relapse</a></span>,</span></span>
<span class="r-in"><span>  lowest_year <span class="op">=</span> <span class="fl">2001</span>,</span></span>
<span class="r-in"><span>  highest_year <span class="op">=</span> <span class="fl">2018</span>,</span></span>
<span class="r-in"><span>  youngest_age <span class="op">=</span> <span class="fl">11</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Forecasting relapse probabilities is tricky because </span></span></span>
<span class="r-in"><span><span class="co"># the probabilities that are used in the model are stratified by age, sex, IMDq and time since quitting</span></span></span>
<span class="r-in"><span><span class="co"># The approach will be to forecast the version of the probabilities stratified by age, sex and IMDq only</span></span></span>
<span class="r-in"><span><span class="co"># and then use the results to scale the higher dimensional version</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">relapse_forecast_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="quit_forecast.html">quit_forecast</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">relapse_data</span><span class="op">$</span><span class="va">relapse_by_age_imd</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  forecast_var <span class="op">=</span> <span class="st">"p_relapse"</span>,</span></span>
<span class="r-in"><span>  forecast_type <span class="op">=</span> <span class="st">"continuing"</span>, <span class="co"># continuing or stationary</span></span></span>
<span class="r-in"><span>  cont_limit <span class="op">=</span> <span class="fl">2030</span>, <span class="co"># the year at which the forecast becomes stationary</span></span></span>
<span class="r-in"><span>  first_year <span class="op">=</span> <span class="fl">2001</span>, <span class="co"># the earliest year of data on which the forecast is based</span></span></span>
<span class="r-in"><span>  jump_off_year <span class="op">=</span> <span class="fl">2018</span>,</span></span>
<span class="r-in"><span>  time_horizon <span class="op">=</span> <span class="fl">2100</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot to check</span></span></span>
<span class="r-in"><span><span class="va">relapse_forecast_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">relapse_forecast_data</span><span class="op">[</span><span class="va">age</span> <span class="op">==</span> <span class="fl">50</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2030</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">p_relapse</span>, colour <span class="op">=</span> <span class="va">imd_quintile</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"P(relapse)"</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span>  <span class="co">#ylim(0, 1) +</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">2018</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">relapse_forecast_plot</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu">relapse_forecast</span><span class="op">(</span></span></span>
<span class="r-in"><span>  relapse_forecast_data <span class="op">=</span> <span class="va">relapse_forecast_data</span>,</span></span>
<span class="r-in"><span>  relapse_by_age_imd_timesincequit <span class="op">=</span> <span class="va">relapse_data</span><span class="op">$</span><span class="va">relapse_by_age_imd_timesincequit</span>,</span></span>
<span class="r-in"><span>  jump_off_year <span class="op">=</span> <span class="fl">2018</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://sheffield.ac.uk/smph/duncan-gillespie" class="external-link">Duncan Gillespie</a>, Laura Webster, Grace Leeming, Magdalena Opazo-Breton, <a href="https://sheffield.ac.uk/smph/people/academic/population-health/alan-brennan" class="external-link">Alan Brennan</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

