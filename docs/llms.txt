# smktrans

### An R Package and Workflow for estimating smoking state transition probabilities

[![Project Status: Active ‚Äì The project has reached a stable, usable
state and is being actively
developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![Lifecycle:
maturing](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://www.tidyverse.org/lifecycle/#maturing)
[![](https://img.shields.io/badge/doi-10.17605/OSF.IO/YGXQ9-green.svg)](https://doi.org/10.17605/OSF.IO/YGXQ9)
‚Äî

## üìñ Overview

**smktrans** is a research compendium structured as an R package. It
serves two distinct purposes: 1. **Toolbox:** It provides a set of R
functions to estimate transition probabilities among current, former,
and never smoking states (initiation, quitting, and relapse) from repeat
cross-sectional survey data. 2. **Workflow:** It contains the specific
analytical workflow used to produce the official estimates for the
Sheffield Tobacco Policy Model (STPM).

This package is part of the **Sheffield Tobacco and Alcohol Policy
Modelling (STAPM)** platform developed by the [School of Health and
Related Research at the University of
Sheffield](https://www.sheffield.ac.uk/scharr).

------------------------------------------------------------------------

## üì¶ Package Structure: A ‚ÄúVertical‚Äù Approach

While `smktrans` can be installed and used like a standard R package, it
is designed to be ‚Äúvertical‚Äù ‚Äî meaning the package encompasses both the
tools *and* the analysis.

The estimates produced by this workflow are probabilities of **smoking
initiation**, **quitting**, and **relapse**, stratified by: \* Age \*
Period \* Sex \* Index of Multiple Deprivation (IMD) quintiles

### Where to find the analysis

The workflow used to produce these estimates, including slides and plots
of trends for England and Scotland, can be found in the repository here:
[üìÇ
transition_probability_estimates](https://github.com/stapm-platform/smktrans/tree/master/transition_probability_estimates)

### Open Science & Estimates

We have made this code open source to ensure transparency, share
methodology, and allow others to utilize our pre-calculated estimates.
\* **England Estimates:** [Download via OSF](https://osf.io/zy9q8) \*
**Scotland Estimates:** [Download via OSF](https://osf.io/wtz7b) \*
**Wales Estimates:** *\[Placeholder: Estimates for Wales are currently
under development and will be linked here once available.\]*

------------------------------------------------------------------------

## üõ† Installation

`smktrans` relies on several internal STAPM packages (`hseclean`,
`tobalcepi`, `mort.tools`). You can install the package directly from
GitHub.

If you are on a University of Sheffield managed computer, we recommend
installing Rtools via the
[installr](https://cran.r-project.org/web/packages/installr/index.html)
package first.

``` r
# install.packages("devtools")

# 1. Install dependencies
devtools::install_git("[https://github.com/stapm/hseclean.git](https://github.com/stapm/hseclean.git)", build_vignettes = FALSE, quiet = TRUE)
devtools::install_git("[https://github.com/stapm/tobalcepi.git](https://github.com/stapm/tobalcepi.git)", build_vignettes = FALSE, quiet = TRUE)
devtools::install_git("[https://github.com/stapm/mort.tools.git](https://github.com/stapm/mort.tools.git)", build_vignettes = FALSE, quiet = TRUE)

# 2. Install smktrans
devtools::install_git("[https://github.com/stapm-platform/smktrans.git](https://github.com/stapm-platform/smktrans.git)", build_vignettes = FALSE, quiet = TRUE)

# Note: You can add ref = "x.x.x" to any of the above to install a specific version.
```

### Usage

``` r
library(smktrans)
library(tobalcepi)
library(hseclean)
library(mort.tools)

# Other useful packages for the workflow
library(data.table)
library(dplyr)
library(ggplot2)
```

------------------------------------------------------------------------

## üìä Data Sources & Inputs

The functions in `smktrans` are designed to process specific data
inputs.

| Input Type | Source / Description | Access |
|:---|:---|:---|
| **Health Survey Data** | Cross-sectional data from the **Health Survey for England (HSE)** and **Scottish Health Survey (SHeS)**. Work to include the **National Survey for Wales** is ongoing. | Requires registration with the [UK Data Service](https://www.ukdataservice.ac.uk/get-data/how-to-access.aspx). |
| **Mortality Data** | Cause-specific death rates stratified by sex and IMD. | Supplied by ONS (England/Wales) and NRS (Scotland). See [cause list](https://osf.io/v945r). |
| **Survivorship** | Birth cohort survivorship derived from historical mortality rates. | [Human Mortality Database](https://www.mortality.org/). |
| **Relapse Data** | Statistical estimates of long-term relapse probabilities ( |  |

# Package index

## Smoking trends

- [`ever_smoke()`](https://stapm-platform.github.io/smktrans/reference/ever_smoke.md)
  : Summarise and project trends in ever-smoking
- [`trend_fit()`](https://stapm-platform.github.io/smktrans/reference/trend_fit.md)
  : Statistically model trends in current, former and never smoking

## Smoking initiation

- [`init_est()`](https://stapm-platform.github.io/smktrans/reference/init_est.md)
  : Cohort specific smoking initiation
- [`init_adj()`](https://stapm-platform.github.io/smktrans/reference/init_adj.md)
  : Adjust probabilities of ever-smoking

## Quitting smoking

- [`quit_est()`](https://stapm-platform.github.io/smktrans/reference/quit_est.md)
  : Estimate smoking quit probabilities
- [`quit_forecast()`](https://stapm-platform.github.io/smktrans/reference/quit_forecast.md)
  : Forecast probabilities of smoking initiation, quitting and relapse
- [`smoke_surv()`](https://stapm-platform.github.io/smktrans/reference/smoke_surv.md)
  : Estimate age-specific probabilities of death by smoking status
- [`prep_surv()`](https://stapm-platform.github.io/smktrans/reference/prep_surv.md)
  : Estimate socioeconomic differences in cohort survivorship

## Relapse to smoking

- [`prep_relapse()`](https://stapm-platform.github.io/smktrans/reference/prep_relapse.md)
  : Prepare long-term relapse probabilities
- [`relapse_forecast()`](https://stapm-platform.github.io/smktrans/reference/relapse_forecast.md)
  : Forecast relapse probabilities

## Misc

- [`bin_var()`](https://stapm-platform.github.io/smktrans/reference/bin_var.md)
  : Bin numeric variable
- [`p_dense()`](https://stapm-platform.github.io/smktrans/reference/p_dense.md)
  : Convert probabilities of ever-smoking to age-specific probabilities
  of smoking initiation
- [`p_smooth()`](https://stapm-platform.github.io/smktrans/reference/p_smooth.md)
  : Smooth age and period pattern in probability values

## Data

- [`hmd_data_eng`](https://stapm-platform.github.io/smktrans/reference/hmd_data_eng.md)
  : Death rates for England & Wales
- [`hmd_data_scot`](https://stapm-platform.github.io/smktrans/reference/hmd_data_scot.md)
  : Death rates for Scotland
- [`hawkins_relapse`](https://stapm-platform.github.io/smktrans/reference/hawkins_relapse.md)
  : Long-term probabilities of smoking relapse

# Articles

### All vignettes

- [Workflow: Smoking state transition probability
  estimation](https://stapm-platform.github.io/smktrans/articles/smk_trans_prob_estimation.md):
- [Get
  started](https://stapm-platform.github.io/smktrans/articles/smktrans.md):
- [Estimating annual probabilities of smoking initiation, quitting and
  relapse from repeat cross-sectional survey data of smoking in England
  (PDF)](https://stapm-platform.github.io/smktrans/articles/smoking_transition_probabilities_modelling_report.pdf):
